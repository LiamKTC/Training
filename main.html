<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hybrid Athlete Training Portal</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
    body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
  </style>
</head>

<body class="pb-20">
  <!-- Header -->
  <header class="bg-slate-900 text-white py-6 px-4 sticky top-0 z-50">
    <div class="max-w-6xl mx-auto flex flex-col gap-3 md:flex-row md:justify-between md:items-center">
      <div>
        <h1 class="text-xl font-bold tracking-tight">Hybrid Training Portal</h1>
        <p class="text-slate-400 text-xs">Run ‚Ä¢ Strength ‚Ä¢ Climb ‚Ä¢ Recovery</p>
      </div>

      <div class="flex items-center gap-3">
        <label class="text-xs text-slate-300" for="weekSelect">Plan week</label>
        <select id="weekSelect" class="bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-blue-500"></select>
      </div>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 mt-8 space-y-8">

    <!-- Today -->
    <section class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
        <div>
          <h2 class="text-lg font-bold flex items-center gap-2">
            <span class="text-blue-600">üìç</span> Today
          </h2>
          <p class="text-sm text-slate-600" id="todaySubtitle">Loading‚Ä¶</p>
        </div>

        <div class="flex gap-2">
          <button id="markDoneBtn" class="px-4 py-2 rounded-xl bg-slate-900 text-white text-sm hover:bg-slate-800">
            Mark done
          </button>
          <button id="clearTodayBtn" class="px-4 py-2 rounded-xl bg-slate-100 text-slate-800 text-sm hover:bg-slate-200">
            Clear
          </button>
        </div>
      </div>

      <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="rounded-xl bg-slate-50 p-4 border border-slate-200">
          <div class="text-xs font-bold text-slate-500 uppercase mb-1">Effort</div>
          <div class="text-sm font-semibold" id="todayEffort">‚Äî</div>
          <div class="text-xs text-slate-500 mt-1">Aim to finish fresh. No hero days.</div>
        </div>

        <div class="rounded-xl bg-slate-50 p-4 border border-slate-200">
          <div class="text-xs font-bold text-slate-500 uppercase mb-2">Knee / Plantar check-in</div>
          <div class="flex items-center gap-3 text-sm">
            <label class="text-slate-700">Knee</label>
            <input id="kneePain" type="range" min="0" max="10" value="0" class="w-full">
            <span id="kneeVal" class="w-6 text-right text-slate-700">0</span>
          </div>
          <div class="flex items-center gap-3 text-sm mt-2">
            <label class="text-slate-700">Plantar</label>
            <input id="plantarPain" type="range" min="0" max="10" value="0" class="w-full">
            <span id="plantarVal" class="w-6 text-right text-slate-700">0</span>
          </div>
          <div class="mt-2 flex items-center gap-2 text-xs text-slate-600">
            <input id="firstStep" type="checkbox" class="rounded">
            <label for="firstStep">Morning ‚Äúfirst-step‚Äù pain</label>
          </div>
        </div>

        <div class="rounded-xl bg-slate-50 p-4 border border-slate-200">
          <div class="text-xs font-bold text-slate-500 uppercase mb-1">Coach note</div>
          <div class="text-sm" id="coachNote">‚Äî</div>
        </div>
      </div>

      <div class="mt-4">
        <label class="text-xs font-bold text-slate-500 uppercase" for="todayNotes">Notes</label>
        <textarea id="todayNotes" rows="2" class="mt-2 w-full rounded-xl border border-slate-200 p-3 text-sm outline-none focus:ring-2 focus:ring-blue-500" placeholder="How did it feel? Any tightness? Shoe / surface notes?"></textarea>
      </div>
    </section>

    <!-- Weekly layout -->
    <section>
      <h2 class="text-lg font-bold mb-4 flex items-center gap-2">
        <span class="text-blue-600">üóìÔ∏è</span> Weekly Structure
      </h2>

      <div id="weekGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-7 gap-4"></div>
    </section>

    <!-- Content -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

      <!-- Strength & climb -->
      <div class="lg:col-span-2 space-y-8">

        <section class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 border-l-4 border-l-purple-500">
          <div class="flex justify-between items-center mb-6">
            <h3 class="text-xl font-bold flex items-center gap-2">üèãÔ∏è Strength (Tuesday)</h3>
            <span class="text-xs text-slate-500">~45 minutes</span>
          </div>

          <div class="space-y-5 text-sm text-slate-700">
            <div class="flex gap-3">
              <div class="w-9 h-9 rounded-lg bg-purple-50 flex items-center justify-center font-bold text-purple-600">A</div>
              <div>
                <div class="font-semibold">Bulgarian split squat <span class="text-xs bg-orange-100 text-orange-700 px-2 py-0.5 rounded ml-2">Knee-friendly</span></div>
                <div class="text-slate-600">3 √ó 6‚Äì8 each leg. 3s down. Progress: add weight once you can do 3√ó8 with perfect control.</div>
              </div>
            </div>

            <div class="flex gap-3">
              <div class="w-9 h-9 rounded-lg bg-purple-50 flex items-center justify-center font-bold text-purple-600">B</div>
              <div>
                <div class="font-semibold">Trap bar deadlift (or goblet squat)</div>
                <div class="text-slate-600">3 √ó 5. RPE ~7. Progress: +5 kg when last set feels solid and technique stays crisp.</div>
              </div>
            </div>

            <div class="flex gap-3 p-3 rounded-xl border border-emerald-200 bg-emerald-50/40">
              <div class="w-9 h-9 rounded-lg bg-emerald-100 flex items-center justify-center font-bold text-emerald-700">C</div>
              <div>
                <div class="font-semibold">Calves (non-negotiable) <span class="text-xs bg-emerald-200 text-emerald-900 px-2 py-0.5 rounded ml-2">Plantar key</span></div>
                <div class="text-slate-700">Straight-leg: 3 √ó 12‚Äì20 ‚Ä¢ Bent-knee (soleus): 3 √ó 12‚Äì15</div>
                <div class="text-xs text-slate-600 mt-1">Rule: increase load only after you can do the top end with full ROM + control.</div>
              </div>
            </div>

            <div class="flex gap-3">
              <div class="w-9 h-9 rounded-lg bg-purple-50 flex items-center justify-center font-bold text-purple-600">D</div>
              <div>
                <div class="font-semibold">Foot intrinsics + tibialis</div>
                <div class="text-slate-600">2‚Äì4 mins: Short-foot holds √ó10, toe yoga √ó10, tibialis raises √ó15.</div>
              </div>
            </div>
          </div>
        </section>

        <section class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 border-l-4 border-l-emerald-500">
          <div class="flex items-center justify-between gap-3">
            <h3 class="text-xl font-bold flex items-center gap-2">üßó Saturday Climb</h3>
            <select id="climbIntensity" class="rounded-xl border border-slate-200 px-3 py-2 text-sm">
              <option value="technique">Technique (easy)</option>
              <option value="volume">Volume (moderate)</option>
              <option value="limit">Limit (hard)</option>
            </select>
          </div>

          <div class="mt-4 bg-slate-50 p-4 rounded-xl border border-slate-200 text-sm text-slate-700 space-y-2">
            <div>‚úÖ Prefer technique/variety most weeks.</div>
            <div>‚úÖ If you choose <span class="font-semibold">Limit (hard)</span>, keep Sunday long run flat and stay at the lower end of the range.</div>
            <div class="text-xs text-slate-500 italic">Goal: protect fingers + feet before long run.</div>
          </div>
        </section>

      </div>

      <!-- Recovery & rules -->
      <div class="space-y-8">

        <section class="bg-slate-900 text-white rounded-2xl shadow-sm border border-slate-800 p-6">
          <h3 class="text-lg font-bold mb-4 flex items-center gap-2">ü¶∂ Daily Rehab (2‚Äì3 min)</h3>
          <ul class="space-y-3 text-sm text-slate-300">
            <li class="flex items-start gap-3"><span class="text-blue-400">01</span><span>Calf stretch: straight + bent knee (30s each)</span></li>
            <li class="flex items-start gap-3"><span class="text-blue-400">02</span><span>Foot roll (ball) 60s</span></li>
            <li class="flex items-start gap-3"><span class="text-blue-400">03</span><span>Slow calf raises 15 reps</span></li>
          </ul>
        </section>

        <section class="bg-white rounded-2xl shadow-sm border border-red-200 p-6 bg-red-50/40">
          <h3 class="text-sm font-bold text-red-700 mb-3 flex items-center gap-2">üö® Load Management Rules</h3>
          <div class="text-xs leading-relaxed text-slate-700 space-y-2">
            <div class="font-bold text-slate-900">Rule of One:</div>
            <div>Don‚Äôt increase more than one per week: long run km ‚Ä¢ climbing intensity ‚Ä¢ calf load.</div>
            <div class="pt-2 border-t border-red-200">
              <div class="font-bold text-red-700 mb-1">Red flags:</div>
              <ul class="list-disc pl-4 space-y-1">
                <li>Sharp morning heel pain</li>
                <li>Knee pain descending stairs</li>
                <li>Arch tightness trending worse weekly</li>
              </ul>
            </div>
          </div>
        </section>

        <section class="bg-white rounded-2xl shadow-sm border border-blue-200 p-6 bg-blue-50/40">
          <h3 class="text-sm font-bold text-blue-800 mb-2 italic">Effort Guide</h3>
          <p class="text-xs text-slate-700">Easy runs = conversational, nose-breathing, RPE 3‚Äì4/10. Long run should feel sustainable.</p>
        </section>

      </div>
    </div>
  </main>

  <script>
    // --- Plan (12 weeks with conservative deloads at 4 and 8) ---
    const weekPlans = {
      1: { mon: "4 km", thu: "5 km", sun: "7 km", effort: "Easy, relaxed", phase: "Foundation" },
      2: { mon: "4 km", thu: "5 km", sun: "8 km", effort: "Easy, relaxed", phase: "Foundation" },
      3: { mon: "4 km", thu: "6 km", sun: "9 km", effort: "Easy, relaxed", phase: "Foundation" },
      4: { mon: "4 km", thu: "5 km", sun: "7 km (deload)", effort: "Easy + extra rehab", phase: "Foundation (deload)" },

      5: { mon: "5 km", thu: "6 km", sun: "10 km", effort: "Easy; smooth form", phase: "Durability" },
      6: { mon: "5 km", thu: "6 km", sun: "11 km", effort: "Easy; smooth form", phase: "Durability" },
      7: { mon: "5 km", thu: "7 km", sun: "12 km", effort: "Easy; optional 4√ó20s strides Thu", phase: "Durability" },
      8: { mon: "5 km", thu: "6 km", sun: "10 km (deload)", effort: "Easy + extra mobility", phase: "Durability (deload)" },

      9:  { mon: "6 km", thu: "7 km", sun: "14 km", effort: "Easy; steady cadence", phase: "Pre-base" },
      10: { mon: "6 km", thu: "7 km", sun: "16 km", effort: "Easy; stay flat", phase: "Pre-base" },
      11: { mon: "6 km", thu: "8 km", sun: "17 km", effort: "Easy; finish fresh", phase: "Pre-base" },
      12: { mon: "6 km", thu: "8 km", sun: "18 km", effort: "Easy; no racing", phase: "Pre-base" },
    };

    const days = [
      { key: "mon", label: "Monday", type: "run", badge: "Easy Run" },
      { key: "tue", label: "Tuesday", type: "strength", badge: "Strength" },
      { key: "wed", label: "Wednesday", type: "rest", badge: "Rest" },
      { key: "thu", label: "Thursday", type: "run", badge: "Easy Run" },
      { key: "fri", label: "Friday", type: "rest", badge: "Rest" },
      { key: "sat", label: "Saturday", type: "climb", badge: "Climb" },
      { key: "sun", label: "Sunday", type: "run", badge: "Long Run" },
    ];

    const badgeClass = {
      run: "bg-blue-100 text-blue-700",
      strength: "bg-purple-100 text-purple-700",
      climb: "bg-emerald-100 text-emerald-700",
      rest: "bg-slate-100 text-slate-600",
    };

    const storageKey = "hybridPortal.v1";
    const state = JSON.parse(localStorage.getItem(storageKey) || "{}");

    function saveState() {
      localStorage.setItem(storageKey, JSON.stringify(state));
    }

    function populateWeeks() {
      const sel = document.getElementById("weekSelect");
      sel.innerHTML = "";
      for (let w = 1; w <= 12; w++) {
        const opt = document.createElement("option");
        opt.value = String(w);
        opt.textContent = `Week ${w} ‚Äî ${weekPlans[w].phase}`;
        sel.appendChild(opt);
      }
      const defaultWeek = state.week || 1;
      sel.value = String(defaultWeek);
    }

    function getTodayKey() {
      // JS: 0=Sun..6=Sat
      const d = new Date().getDay();
      return ["sun","mon","tue","wed","thu","fri","sat"][d];
    }

    function coachNoteFor(pain) {
      const { knee, plantar, firstStep } = pain;
      if (plantar >= 4 || firstStep) {
        return "Plantar is cranky: keep runs flat + easy, cap long run at lower end, reduce jumping/limit bouldering. Keep calf work but drop 1 set.";
      }
      if (knee >= 4) {
        return "Knee is cranky: avoid hills, shorten stride, reduce split squat depth and keep strength moderate today.";
      }
      return "Green light: keep it easy, focus on smooth form and finish fresh.";
    }

    function renderWeek() {
      const week = Number(document.getElementById("weekSelect").value);
      state.week = week; saveState();

      const plan = weekPlans[week];
      const grid = document.getElementById("weekGrid");
      grid.innerHTML = "";

      const todayKey = getTodayKey();

      days.forEach(d => {
        const card = document.createElement("div");
        const isToday = d.key === todayKey;

        const base = "bg-white rounded-2xl shadow-sm border border-slate-200 p-4 transition-all hover:shadow-md";
        const todayRing = isToday ? " ring-2 ring-blue-500" : "";
        const restStyle = d.type === "rest" ? " bg-slate-50 border-dashed" : "";
        card.className = base + todayRing + restStyle;

        const badge = document.createElement("div");
        badge.className = `inline-block px-3 py-1 rounded-full text-[11px] font-bold uppercase ${badgeClass[d.type]}`;
        badge.textContent = d.badge;

        const title = document.createElement("div");
        title.className = "text-xs font-bold text-slate-400 mb-2 uppercase";
        title.textContent = d.label;

        const main = document.createElement("div");
        main.className = "mt-2 text-sm font-semibold text-slate-900";

        let detail = "";
        if (d.key === "mon") detail = plan.mon;
        else if (d.key === "thu") detail = plan.thu;
        else if (d.key === "sun") detail = plan.sun;
        else if (d.key === "tue") detail = "Full session";
        else if (d.key === "sat") detail = "Bouldering (choose intensity)";
        else detail = "Recovery + rehab";

        main.textContent = detail;

        const footer = document.createElement("div");
        footer.className = "mt-3 flex items-center justify-between gap-2";

        const doneId = `${week}.${d.key}.done`;
        const done = document.createElement("label");
        done.className = "flex items-center gap-2 text-xs text-slate-600 cursor-pointer";
        done.innerHTML = `<input type="checkbox" class="rounded" ${state[doneId] ? "checked" : ""}/> Done`;

        done.querySelector("input").addEventListener("change", (e) => {
          state[doneId] = e.target.checked; saveState();
          updateTodayPanel();
        });

        const noteBtn = document.createElement("button");
        noteBtn.className = "text-xs text-blue-700 hover:underline";
        noteBtn.textContent = "Note";
        noteBtn.addEventListener("click", () => {
          const key = `${week}.${d.key}.note`;
          const val = prompt("Add a quick note for this day:", state[key] || "");
          if (val !== null) {
            state[key] = val.trim();
            saveState();
            updateTodayPanel();
          }
        });

        footer.appendChild(done);
        footer.appendChild(noteBtn);

        card.appendChild(title);
        card.appendChild(badge);
        card.appendChild(main);
        card.appendChild(footer);

        grid.appendChild(card);
      });

      updateTodayPanel();
    }

    function updateTodayPanel() {
      const week = Number(document.getElementById("weekSelect").value);
      const plan = weekPlans[week];
      const todayKey = getTodayKey();

      const labelMap = { mon:"Monday", tue:"Tuesday", wed:"Wednesday", thu:"Thursday", fri:"Friday", sat:"Saturday", sun:"Sunday" };

      let todayTask = "";
      if (todayKey === "mon") todayTask = `Easy run ‚Äî ${plan.mon}`;
      else if (todayKey === "thu") todayTask = `Easy run ‚Äî ${plan.thu}`;
      else if (todayKey === "sun") todayTask = `Long run ‚Äî ${plan.sun}`;
      else if (todayKey === "tue") todayTask = "Strength session ‚Äî full";
      else if (todayKey === "sat") todayTask = "Climb ‚Äî choose intensity";
      else todayTask = "Recovery + rehab";

      document.getElementById("todaySubtitle").textContent = `${labelMap[todayKey]} (Week ${week} ‚Äî ${plan.phase}): ${todayTask}`;
      document.getElementById("todayEffort").textContent = plan.effort;

      // Pain UI
      const knee = Number(document.getElementById("kneePain").value);
      const plantar = Number(document.getElementById("plantarPain").value);
      const firstStep = document.getElementById("firstStep").checked;

      document.getElementById("kneeVal").textContent = knee;
      document.getElementById("plantarVal").textContent = plantar;

      document.getElementById("coachNote").textContent = coachNoteFor({ knee, plantar, firstStep });

      // Notes persistence per week/day
      const notesKey = `${week}.${todayKey}.note`;
      const notesEl = document.getElementById("todayNotes");
      if (notesEl.dataset.boundKey !== notesKey) {
        notesEl.dataset.boundKey = notesKey;
        notesEl.value = state[notesKey] || "";
      }
    }

    // Buttons
    document.getElementById("markDoneBtn").addEventListener("click", () => {
      const week = Number(document.getElementById("weekSelect").value);
      const todayKey = getTodayKey();
      state[`${week}.${todayKey}.done`] = true;
      saveState();
      renderWeek();
    });

    document.getElementById("clearTodayBtn").addEventListener("click", () => {
      const week = Number(document.getElementById("weekSelect").value);
      const todayKey = getTodayKey();
      delete state[`${week}.${todayKey}.done`];
      delete state[`${week}.${todayKey}.note`];
      saveState();
      renderWeek();
    });

    // Inputs
    ["kneePain","plantarPain","firstStep"].forEach(id => {
      document.getElementById(id).addEventListener("input", updateTodayPanel);
      document.getElementById(id).addEventListener("change", updateTodayPanel);
    });

    document.getElementById("todayNotes").addEventListener("input", (e) => {
      const week = Number(document.getElementById("weekSelect").value);
      const todayKey = getTodayKey();
      state[`${week}.${todayKey}.note`] = e.target.value;
      saveState();
    });

    document.getElementById("weekSelect").addEventListener("change", renderWeek);

    document.getElementById("climbIntensity").addEventListener("change", (e) => {
      state.climbIntensity = e.target.value;
      saveState();
    });

    // Init
    populateWeeks();
    if (state.climbIntensity) document.getElementById("climbIntensity").value = state.climbIntensity;
    renderWeek();
  </script>
</body>
</html>
